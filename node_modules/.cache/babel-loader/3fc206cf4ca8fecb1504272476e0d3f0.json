{"ast":null,"code":"const got = require('got');\n\nconst Sneaker = require('../models/Sneaker');\n\nmodule.exports = {\n  getProductsAndInfo: async function (key, count, callback) {\n    try {\n      const response = await got.post('https://xw7sbct9v6-1.algolianet.com/1/indexes/products/query?x-algolia-agent=Algolia%20for%20vanilla%20JavaScript%203.32.1&x-algolia-application-id=XW7SBCT9V6&x-algolia-api-key=6b5e76b49705eb9f51a06d3c82f7acee', {\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36',\n          \"accept\": \"application/json\",\n          \"accept-language\": \"en-US,en;q=0.9\",\n          \"content-type\": \"application/x-www-form-urlencoded\",\n          \"sec-fetch-dest\": \"empty\",\n          \"sec-fetch-mode\": \"cors\",\n          \"sec-fetch-site\": \"cross-site\"\n        },\n        body: `{\"params\":\"query=${key}&facets=*&filters=&hitsPerPage=${count}\"}`,\n        http2: true\n      });\n      var json = JSON.parse(response.body);\n      var products = [];\n      var numOfShoes = json.hits.length;\n\n      for (var i = 0; i < json.hits.length; i++) {\n        if (!json.hits[i].style_id || json.hits[i].style_id.indexOf(' ') >= 0) {\n          numOfShoes--;\n          continue;\n        }\n\n        var shoe = new Sneaker({\n          shoeName: json.hits[i].name,\n          brand: json.hits[i].brand,\n          silhoutte: json.hits[i].make,\n          styleID: json.hits[i].style_id,\n          make: json.hits[i].make,\n          colorway: json.hits[i].colorway,\n          retailPrice: json.hits[i].searchable_traits['Retail Price'],\n          thumbnail: json.hits[i].media.imageUrl,\n          releaseDate: json.hits[i].release_date,\n          description: json.hits[i].description,\n          urlKey: json.hits[i].url,\n          resellLinks: {\n            stockX: 'https://stockx.com/' + json.hits[i].url\n          }\n        });\n\n        if (json.hits[i].lowest_ask) {\n          shoe.lowestResellPrice.stockX = json.hits[i].lowest_ask;\n        }\n\n        products.push(shoe);\n      }\n\n      if (products.length == 0 || numOfShoes == 0) {\n        callback(new Error('Product Not Found'), null);\n      } else {\n        callback(null, products);\n      }\n    } catch (error) {\n      let err = new Error(\"Could not connect to StockX while searching '\", key, \"' Error: \", error);\n      console.log(err);\n      callback(err, products);\n    }\n  },\n  getPrices: async function (shoe, callback) {\n    let priceMap = {};\n\n    try {\n      const response = await got('https://stockx.com/api/products/' + shoe.urlKey + '?includes=market', {\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15'\n        },\n        http2: true\n      });\n      let json = JSON.parse(response.body);\n      Object.keys(json.Product.children).forEach(function (key) {\n        if (json.Product.children[key].market.lowestAsk == 0) return; //if size is in womens, then remove \"W\"\n\n        var size = json.Product.children[key].shoeSize;\n\n        if (size[size.length - 1] == 'W') {\n          size = size.substring(0, size.length - 1);\n        }\n\n        priceMap[size] = json.Product.children[key].market.lowestAsk;\n      });\n      shoe.resellPrices.stockX = priceMap;\n      callback();\n    } catch (error) {\n      console.log(error);\n      let err = new Error(\"Could not connect to StockX while searching '\", shoe.styleID, \"' Error: \", error);\n      console.log(err);\n      callback(err);\n    }\n  }\n};","map":{"version":3,"names":["got","require","Sneaker","module","exports","getProductsAndInfo","key","count","callback","response","post","headers","body","http2","json","JSON","parse","products","numOfShoes","hits","length","i","style_id","indexOf","shoe","shoeName","name","brand","silhoutte","make","styleID","colorway","retailPrice","searchable_traits","thumbnail","media","imageUrl","releaseDate","release_date","description","urlKey","url","resellLinks","stockX","lowest_ask","lowestResellPrice","push","Error","error","err","console","log","getPrices","priceMap","Object","keys","Product","children","forEach","market","lowestAsk","size","shoeSize","substring","resellPrices"],"sources":["C:/Users/hamzu/Desktop/React/React projects/react-store/node_modules/sneaks-api/scrapers/stockx-scraper.js"],"sourcesContent":["const got = require('got');\nconst Sneaker = require('../models/Sneaker');\n\n\nmodule.exports = {\n    getProductsAndInfo: async function (key, count, callback) {\n      \n        try {\n            const response = await got.post('https://xw7sbct9v6-1.algolianet.com/1/indexes/products/query?x-algolia-agent=Algolia%20for%20vanilla%20JavaScript%203.32.1&x-algolia-application-id=XW7SBCT9V6&x-algolia-api-key=6b5e76b49705eb9f51a06d3c82f7acee', {\n                headers: {\n                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36',\n                    \"accept\": \"application/json\",\n                    \"accept-language\": \"en-US,en;q=0.9\",\n                    \"content-type\": \"application/x-www-form-urlencoded\",\n                    \"sec-fetch-dest\": \"empty\",\n                    \"sec-fetch-mode\": \"cors\",\n                    \"sec-fetch-site\": \"cross-site\"\n                },\n                body: `{\"params\":\"query=${key}&facets=*&filters=&hitsPerPage=${count}\"}`,\n                http2: true\n            });\n           \n            \n            var json = JSON.parse(response.body);\n            var products = [];\n            var numOfShoes = json.hits.length;\n\n            for (var i = 0; i < json.hits.length; i++) {\n                if (!json.hits[i].style_id || (json.hits[i].style_id).indexOf(' ') >= 0) {\n                    numOfShoes--;\n                    continue;\n                }\n                var shoe = new Sneaker({\n                    shoeName: json.hits[i].name,\n                    brand: json.hits[i].brand,\n                    silhoutte: json.hits[i].make,\n                    styleID: json.hits[i].style_id,\n                    make: json.hits[i].make,\n                    colorway: json.hits[i].colorway,\n                    retailPrice: json.hits[i].searchable_traits['Retail Price'],\n                    thumbnail: json.hits[i].media.imageUrl,\n                    releaseDate: json.hits[i].release_date,\n                    description: json.hits[i].description,\n                    urlKey: json.hits[i].url,\n                    resellLinks: {\n                        stockX: 'https://stockx.com/' + json.hits[i].url\n                    }\n                });\n                if(json.hits[i].lowest_ask){\n                    shoe.lowestResellPrice.stockX = json.hits[i].lowest_ask;\n                }\n                products.push(shoe)\n            }\n          \n            if (products.length == 0 || numOfShoes == 0) {\n                callback(new Error('Product Not Found'), null);\n            } \n            else {\n                callback(null, products);\n            }\n        } catch (error) {\n            let err = new Error(\"Could not connect to StockX while searching '\", key, \"' Error: \", error)\n            console.log(err);\n            callback(err, products)\n        }\n    },\n\n    getPrices: async function (shoe, callback) {\n        let priceMap = {}\n        try {\n            const response = await got('https://stockx.com/api/products/' + shoe.urlKey + '?includes=market', {\n                headers: {\n                    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15'\n                },\n                http2: true\n            });\n            let json = JSON.parse(response.body);\n            Object.keys(json.Product.children).forEach(function (key) {\n                if (json.Product.children[key].market.lowestAsk == 0) return;\n                //if size is in womens, then remove \"W\"\n                var size = json.Product.children[key].shoeSize\n                if(size[size.length-1] == 'W'){\n                    size = size.substring(0, size.length - 1);\n                    \n                }\n                priceMap[size] = json.Product.children[key].market.lowestAsk;\n                \n            });\n            shoe.resellPrices.stockX = priceMap;\n            callback();\n        } catch (error) {\n            console.log(error)\n            let err = new Error(\"Could not connect to StockX while searching '\", shoe.styleID, \"' Error: \", error)\n            console.log(err);\n            callback(err)\n\n        }\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}